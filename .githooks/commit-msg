#!/bin/bash
set -euo pipefail

MSG=$(cat "$1")
PATTERN='^(feat|fix|docs|infra|ci|chore|refactor)(\([a-z0-9_/-]+\))?: [a-z].+'

if ! grep -Eq "$PATTERN" <<< "$MSG"; then
    echo "âŒ Commit message does not follow Conventional Commits format."
    echo ""
    echo "ðŸ§  Expected format:"
    echo "  type(scope): lowercase summary"
    echo ""
    echo "âœ… Examples:"
    echo "  feat(sync): add rsync container"
    echo "  fix(env): correct env var loading order"
    echo "  docs(readme): update bootstrap instructions"
    echo "  chore(pre-commit): add secret scanning hook"
    echo ""
    echo "ðŸ“ Your message:"
    echo "  $MSG"
    echo ""
    echo "ðŸ“š Allowed types: feat, fix, docs, infra, ci, chore, refactor"
    echo "ðŸ“š Allowed scope characters: lowercase a-z, 0-9, _, -, /"
    exit 1
fi
